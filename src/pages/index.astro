---
import Base from '../layouts/Base.astro';
import { getCollection } from 'astro:content';
import { formatDate, getSlug } from '../utils';

const POSTS_PER_PAGE = 10;

const posts = await getCollection('posts', ({ data }) => !data.draft);
const sortedPosts = posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const totalPages = Math.ceil(sortedPosts.length / POSTS_PER_PAGE);
const paginatedPosts = sortedPosts.slice(0, POSTS_PER_PAGE);
---

<Base>
  <h1>Recent</h1>
  {paginatedPosts.length === 0 ? (
    <p>No posts yet.</p>
  ) : (
    <ul class="post-list">
      {paginatedPosts.map((post) => (
        <li>
          <a href={`/${getSlug(post.slug)}`}>{post.data.title}</a>
          <time datetime={post.data.date.toISOString()}>{formatDate(post.data.date)}</time>
        </li>
      ))}
    </ul>
  )}

  {totalPages > 1 && (
    <nav class="pagination">
      <span class="current">1</span>
      {totalPages > 1 && <a href="/page/2">2</a>}
      {totalPages > 2 && <a href={`/page/${totalPages}`}>{totalPages}</a>}
      <a href="/page/2" class="next">Next &rarr;</a>
    </nav>
  )}
</Base>

<style>
  h1 {
    margin-bottom: 2.5rem;
  }
</style>
